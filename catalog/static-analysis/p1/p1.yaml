rules:
    - id: p1
      message: Avoid string concatenation in loop
      languages: [ java ]
      severity: WARNING
      patterns:
          - focus-metavariable: $STR
          - pattern-either:
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          for (...) {
                              ...
                              $STR += ...;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          for (...) {
                              ...
                              $STR = $STR + ...;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          for (...) {
                              ...
                              $STR = ... + $STR;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          while (...) {
                              ...
                              $STR += ...;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          while (...) {
                              ...
                              $STR = $STR + ...;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          while (...) {
                              ...
                              $STR = ... + $STR;
                              ...
                          }
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          do {
                              ...
                              $STR += ...;
                              ...
                          } while (...)
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          do {
                              ...
                              $STR = $STR + ...;
                              ...
                          } while (...)
                          ...
                      }
                - pattern: |
                      $F(...) {
                          ...
                          $STR = ...;
                          ...
                          do {
                              ...
                              $STR = ... + $STR;
                              ...
                          } while (...)
                          ...
                      }
          - pattern-not: |
                for (...) {
                  ...
                  for (...) {
                    ...
                  }
                }
          - pattern-not: |
                while (...) {
                  ...
                  while (...) {
                    ...
                  }
                }
